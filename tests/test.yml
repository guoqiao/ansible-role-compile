#!/usr/bin/env ansible-playbook
---
- hosts: localhost
  vars:
    # have to use system python3
    ansible_python_interpreter: /usr/bin/python3
  environment:
    LD_LIBRARY_PATH: /usr/local/lib
  tasks:

    - name: build python3
      include_role:
        name: guoqiao.xbuild
      tags: python3
      vars:
        pkg_name: "python3"
        builddep_pkgs_apt: ["python3-defaults"]
        extradep_pkgs_apt: ["libffi-dev"]
        builddep_pkgs_yum: ["python"]
        extradep_pkgs_yum: ["libffi-devel"]
        builddep_pkgs_dnf: ["python3"]
        extradep_pkgs_dnf: ["libffi-devel"]
        git_repo_url: https://github.com/python/cpython.git
        git_repo_version: v3.7.2
        # vim compile will fail if --with-pydebug
        # --enable-shared is required by ycm
        command_configure: >
          ./configure
          --prefix=/usr/local
          --enable-shared
          --with-pymalloc
        command_check: "python3 -VV"

    - name: build vim
      include_role:
        name: guoqiao.xbuild
      tags: vim
      vars:
        pkg_name: vim
        git_repo_url: https://github.com/vim/vim.git
        command_configure: >
          ./configure
          --enable-python3interp=yes
          --with-python3-command=python3
